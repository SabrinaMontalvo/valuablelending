<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Valuable Calculator™ — Old School Mortgage Tools</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <img src="/icons/logo-vc.png" alt="Valuable Calculator logo"
         style="height:44px;width:auto;display:none;" onload="this.style.display='block'">
    <h1>Valuable Calculator™ — Old School Mortgage Tools</h1>
  </header>

  <main class="wrap">
    <!-- Your calculator and sections (unchanged) -->

    <!-- Equity / LTV card is already here -->
    <!-- Make sure this part is above, not inside script -->
  </main>

  <footer>
    <p>© Sabrina Montalvo — Valuable Calculator™</p>
    <p>Educational only; principal &amp; interest shown (escrows not included). Not a commitment to lend. NMLS #575897.</p>
  </footer>

  <script>
  /* ===== OLD-SCHOOL CALC (with keyboard) ===== */
  (() => {
    const screen = document.getElementById('screen');
    let cur='0', op=null, mem=null;
    const render=()=>{screen.textContent = cur;}
    const press=(k)=>{
      if (/^[0-9]$/.test(k)){ cur = (cur==='0') ? k : cur+k; }
      else if (k==='.'){ if(!cur.includes('.')) cur += '.'; }
      else if (k==='C'){ cur='0'; op=null; mem=null; }
      else if (k==='⌫'){ cur = (cur.length>1)? cur.slice(0,-1):'0'; }
      else if (['+','-','*','/'].includes(k)){ mem=parseFloat(cur); op=k; cur='0'; }
      else if (k==='='){
        if (op && mem!==null){
          const a=mem, b=parseFloat(cur);
          let r=0; if(op==='+') r=a+b; if(op==='-') r=a-b; if(op==='*') r=a*b; if(op==='/') r=b===0?0:a/b;
          cur = String(r); op=null; mem=null;
        }
      }
      render();
    };
    document.querySelectorAll('.key').forEach(btn=>btn.addEventListener('click',()=>press(btn.dataset.k)));
    document.addEventListener('keydown', (e) => {
      const map = { 'Enter':'=', 'Backspace':'⌫', 'Escape':'C', '*':'*', '/':'/', '+':'+', '-':'-', '.':'.' };
      if (/^[0-9]$/.test(e.key)) { press(e.key); return; }
      if (map[e.key]) { press(map[e.key]); e.preventDefault(); }
    });
    render();
  })();

  /* ===== Equity / LTV (JS) ===== */
  function money(v){ return (v||0).toLocaleString(undefined,{style:'currency',currency:'USD'}); }

  function vUpdate(){
    const val   = +document.getElementById('v_value').value || 0;
    const mort  = +document.getElementById('v_mort').value  || 0;
    const other = +document.getElementById('v_other').value || 0;
    const bench = Math.max(0, Math.min(100, +document.getElementById('v_bench').value || 0));

    const debt = mort + other;
    const ltv  = val ? (debt / val) * 100 : 0;

    // KPIs
    document.getElementById('v_debt').textContent  = money(debt);
    document.getElementById('v_ltv').textContent   = (Math.round(ltv*10)/10) + '%';
    const maxAtBench = val * (bench/100);
    const avail      = Math.max(0, maxAtBench - debt);
    document.getElementById('v_max').textContent   = money(maxAtBench);
    document.getElementById('v_avail').textContent = money(avail);

    // Donut
    drawDonut('v_donut', (ltv/100), val - debt, debt);
  }

  window.addEventListener('load', vUpdate);
  ['v_value','v_mort','v_other','v_bench'].forEach(id=>{
    const el = document.getElementById(id);
    if(el){ el.addEventListener('input', vUpdate); }
  });

  /* ===== drawDonut function ===== */
  function drawDonut(id, ltvPct, equityAmt, debtAmt){
    const c=document.getElementById(id); if(!c) return;
    const ctx=c.getContext('2d');
    const w=c.clientWidth||300, h=c.clientHeight||240;
    const dpr=window.devicePixelRatio||1;
    c.width=w*dpr; c.height=h*dpr; ctx.scale(dpr,dpr);
    ctx.clearRect(0,0,w,h);

    const cx=w/2, cy=h/2;
    const R=Math.min(w,h)*0.40, r=R*0.62;
    const ring=(R+r)/2, lw=R-r;

    const styles=getComputedStyle(document.documentElement);
    const colDebt=styles.getPropertyValue('--ink').trim() || '#01311F';
    const colEquity=styles.getPropertyValue('--gold').trim() || '#C6AA58';

    // background ring
    ctx.lineWidth=lw;
    ctx.beginPath(); ctx.arc(cx,cy,ring,0,Math.PI*2);
    ctx.strokeStyle='#E7E1D6'; ctx.stroke();

    const debtFrac=Math.max(0,Math.min(1,ltvPct||0));
    const start=-Math.PI/2;

    // debt arc
    ctx.beginPath();
    ctx.arc(cx,cy,ring,start,start+Math.PI*2*debtFrac);
    ctx.strokeStyle=colDebt; ctx.lineCap='round'; ctx.stroke();

    // equity arc
    ctx.beginPath();
    ctx.arc(cx,cy,ring,start+Math.PI*2*debtFrac,start+Math.PI*2);
    ctx.strokeStyle=colEquity; ctx.lineCap='round'; ctx.stroke();

    // center labels
    ctx.textAlign='center';
    ctx.fillStyle='#333'; ctx.font='600 14px system-ui';
    ctx.fillText('LTV',cx,cy-12);
    ctx.fillStyle='#111'; ctx.font='800 20px system-ui';
    ctx.fillText(Math.round((ltvPct||0)*100)+'%',cx,cy+6);

    ctx.fillStyle='#555'; ctx.font='600 12px system-ui';
    ctx.fillText('Balances',cx,cy+26);
    const debtText=(debtAmt!=null)?debtAmt.toLocaleString(undefined,{style:'currency',currency:'USD'}):'$0';
    ctx.fillStyle='#111'; ctx.font='700 14px system-ui';
    ctx.fillText(debtText,cx,cy+44);
  }
  </script>
</body>
</html>

