<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Valuable Calculator‚Ñ¢ ‚Äî Old-School Mortgage Tools</title>
<style>
:root{
  --emerald:#01311F;
  --gold:#C6AA58;
  --cream:#F3F2ED;
  --mauve:#B98EA7;
  --mint:#83C08A;
  --ink:#1f2421;
  --border:#E7E1D6;
  --chip:#faf9f6;
}
*{box-sizing:border-box}
html,body{margin:0}
body{
  font:16px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  background:var(--cream); color:var(--ink);
}
header{background:var(--emerald);color:#fff;padding:18px 14px;text-align:center}
header h1{margin:0 0 6px;font-weight:900;letter-spacing:.2px}
header h1 .accent{color:var(--gold)}
header p{margin:0;opacity:.9}
.container{max-width:1200px;margin:22px auto;padding:0 14px}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:18px}
.card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:18px;box-shadow:0 2px 6px rgba(1,49,31,.06)}
h2{margin:4px 0 12px;color:var(--emerald);font-size:1.25rem}

label{display:block;margin:8px 0 4px;font-weight:650}
input,select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:#fff}

/* Hide number spinners so typing feels natural */
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button{ -webkit-appearance:none; margin:0; }
input[type=number]{ -moz-appearance:textfield; }

.btn{display:inline-block;background:var(--gold);color:#fff;border:none;border-radius:12px;padding:10px 16px;font-weight:750;cursor:pointer}
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin:12px 0}
.kpi{background:var(--chip);border:1px solid var(--border);border-radius:10px;padding:10px}
.kpi b{display:block;font-size:.85rem;color:#55625b}

.legend{display:flex;gap:14px;flex-wrap:wrap;align-items:center;margin-top:8px}
.legend .dot{width:12px;height:12px;border-radius:50%}
.note{font-size:.9rem;color:#465249;margin-top:6px}

details summary{cursor:pointer;font-weight:800;color:#16392d}
.kbd{font-family:ui-monospace,Menlo,Consolas,monospace;background:var(--chip);border:1px solid var(--border);border-radius:10px;padding:12px;font-size:1.15rem}
.calc-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}
.calc-grid button{padding:14px 0;border-radius:12px;border:1px solid var(--border);background:#fff;font-weight:800;cursor:pointer}
.calc-grid button.equals{background:var(--gold);color:#fff}
.calc-grid button.alt{background:#f3efe7}

.bench-toggle{display:inline-flex;border:1px solid var(--border);border-radius:999px;overflow:hidden}
.bench-toggle button{padding:6px 12px;border:0;background:#fff;cursor:pointer}
.bench-toggle button.active{background:var(--emerald);color:#fff}

canvas{display:block;margin:6px auto 0;max-width:460px;width:100%;height:auto}
table{width:100%;border-collapse:collapse;border:1px solid var(--border);margin-top:12px}
th,td{border:1px solid var(--border);padding:8px;text-align:center}
thead tr{background:var(--chip)}
footer{padding:18px;text-align:center;border-top:1px solid var(--border);background:#fafafa;margin-top:22px}

@media (max-width:900px){.grid{grid-template-columns:1fr}}
</style>
</head>
<body>
<header>
  <h1>Valuable Calculator‚Ñ¢ <span class="accent">Old-School</span> + Mortgage Tools</h1>
  <p>Free, nostalgic, and practical. Always consult a licensed professional.</p>
</header>

<div class="container">
  <div class="grid">
    <!-- Collapsible calculator -->
    <div class="card">
      <details open>
        <summary>‚ñæ Old-School Calculator</summary>
        <input id="calcDisplay" class="kbd" type="text" value="0" aria-label="Calculator display" readonly>
        <div id="calcPad" class="calc-grid"></div>
        <p class="note">Tip: type numbers & operators on your keyboard, or tap the keys above.</p>
      </details>
    </div>

    <!-- Equity -->
    <div class="card">
      <h2>üè° Equity (Mortgage + Liens + Available)</h2>

      <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
        <div><label>Estimated Home Value ($)</label><input id="v_value" type="number" step="any" value="330000" inputmode="decimal"></div>
        <div><label>Primary Mortgage Balance ($)</label><input id="v_mort" type="number" step="any" value="120000" inputmode="decimal"></div>
        <div><label>Other Liens ($)</label><input id="v_other" type="number" step="any" value="0" inputmode="decimal"></div>

        <div>
          <label>Benchmark LTV (%)</label>
          <div class="bench-toggle" aria-label="Benchmark">
            <button id="bench80" class="active">80%</button>
            <button id="bench90">90%</button>
            <button id="bench100">100%</button>
          </div>
          <input id="v_bench" type="hidden" value="80">
        </div>
      </div>

      <div style="margin-top:8px">
        <button class="btn" id="recalcBtn">Recalculate</button>
      </div>

      <div class="kpis">
        <div class="kpi"><b>Total Debt</b><span id="v_debt">$0</span></div>
        <div class="kpi"><b>LTV</b><span id="v_ltv">0%</span></div>
        <div class="kpi"><b>Max @ Benchmark</b><span id="v_max">$0</span></div>
        <div class="kpi"><b>Available @ Benchmark</b><span id="v_avail">$0</span></div>
      </div>

      <canvas id="v_donut" width="460" height="460" aria-label="Equity donut chart"></canvas>

      <div class="legend" aria-label="Color key">
        <div class="dot" style="background:var(--mauve)"></div><span>Mortgage</span>
        <div class="dot" style="background:var(--mint)"></div><span>Other liens</span>
        <div class="dot" style="background:var(--gold)"></div><span>Available estimated equity</span>
        <div class="dot" style="background:var(--cream);border:1px solid var(--border)"></div><span>Untouchable equity</span>
      </div>
      <p class="note">
        The ring is your home‚Äôs value (outer = 100%). From the top ‚Äústart‚Äù mark clockwise:
        Mortgage (mauve) + Other Liens (mint) that are eating up equity already,
        gold shades <b>available estimated equity</b>, and cream shows <b>untouchable equity</b>
        (based on assumed LTV rules). As always, speak to a licensed professional and have them explain your solution.
      </p>
    </div>
  </div>

  <!-- Amortization -->
  <div class="card" style="margin-top:16px">
    <h2>üìÖ Amortization with Start Date + Extra Payments</h2>
    <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:12px">
      <div><label>Original Loan Amount ($)</label><input id="loanAmt" type="number" step="any" value="300000"></div>
      <div><label>APR (%)</label><input id="apr" type="number" step="0.01" value="6.5"></div>
      <div><label>Term (years)</label><input id="term" type="number" step="1" value="30"></div>
      <div><label>Origination Date</label><input id="origDate" type="date"></div>
      <div><label>Current Balance (optional)</label><input id="curBal" type="number" step="any" placeholder="leave blank if new loan"></div>
      <div><label>Extra Principal ($/mo)</label><input id="extra" type="number" step="any" value="100"></div>
      <div>
        <label>Bi-weekly plan</label>
        <select id="biweekly">
          <option>No</option>
          <option>Yes</option>
        </select>
      </div>
      <div><label>One-time Lump ($)</label><input id="lump" type="number" step="any" value="0"></div>
      <div><label>Lump at month #</label><input id="lumpMonth" type="number" step="1" value="12"></div>
    </div>

    <div class="kpis">
      <div class="kpi"><b>Base P&I</b><span id="kpiBase">‚Äî</span></div>
      <div class="kpi"><b>Projected Payoff</b><span id="kpiPayoff">‚Äî</span></div>
      <div class="kpi"><b>Interest Saved</b><span id="kpiSaved">‚Äî</span></div>
      <div class="kpi"><b>Months Saved</b><span id="kpiMonths">‚Äî</span></div>
    </div>

    <div style="margin-top:8px"><button class="btn" id="amortBtn">Calculate</button></div>
    <table>
      <thead><tr><th>#</th><th>Date</th><th>Payment</th><th>Interest</th><th>Principal</th><th>Extra</th><th>Balance</th></tr></thead>
      <tbody id="amortBody"></tbody>
    </table>
    <p class="note">
      Educational only. Principal & interest shown (escrows not included). Not a commitment to lend.
      <b>Bi-weekly:</b> modeled transparently as about <b>one extra monthly payment per year</b> (26 half-payments ‚âà 13 monthly).
      Always consult a licensed professional.
    </p>
  </div>

  <!-- Refi Break-Even -->
  <div class="card" style="margin-top:16px">
    <h2>üîÅ Refinance Break-Even</h2>
    <div class="grid" style="grid-template-columns:1fr 1fr;gap:12px">
      <div><label>Total refinance costs ($)</label><input id="refiCosts" type="number" step="any" value="4500"></div>
      <div><label>Monthly payment savings ($)</label><input id="refiSavings" type="number" step="any" value="150"></div>
    </div>
    <div style="margin-top:8px"><button class="btn" id="refiBtn">Calculate</button></div>
    <div class="kpis">
      <div class="kpi"><b>Break-even (months)</b><span id="refiMonths">‚Äî</span></div>
      <div class="kpi"><b>Rounded up</b><span id="refiMonthsCeil">‚Äî</span></div>
    </div>
    <p class="note">Formula: <code>months = total refinance costs √∑ monthly savings</code>. If savings ‚â§ 0, break-even is not achievable.</p>
  </div>
</div>

<footer>¬© Sabrina Montalvo ‚Äî Valuable Calculator‚Ñ¢ ¬∑ NMLS #575897</footer>

<script>
/* ============== Calculator ============== */
const calcDisplay=document.getElementById('calcDisplay');
const keys=['7','8','9','√∑','4','5','6','√ó','1','2','3','‚àí','0','.', '=', '+','‚å´','C'];
const pad=document.getElementById('calcPad');
keys.forEach(k=>{
  const b=document.createElement('button'); b.textContent=k;
  if(k==='=') b.classList.add('equals'); if(k==='C'||k==='‚å´') b.classList.add('alt');
  b.onclick=()=>press(k); pad.appendChild(b);
});
function press(k){
  if(k==='C'){calcDisplay.value='0';return;}
  if(k==='‚å´'){calcDisplay.value=calcDisplay.value.length>1?calcDisplay.value.slice(0,-1):'0';return;}
  if(k==='='){evaluateCalc();return;}
  const opMap={'√∑':'/','√ó':'*','‚àí':'-','+':'+'}; const v=opMap[k]??k;
  if(calcDisplay.value==='0' && /[0-9]/.test(v)) calcDisplay.value=v; else calcDisplay.value+=v;
}
function evaluateCalc(){ try{calcDisplay.value=String(eval(calcDisplay.value))}catch{calcDisplay.value='Err'} }

/* Keyboard ‚Üí calculator, but ONLY when not typing in other inputs */
window.addEventListener('keydown',e=>{
  const el=document.activeElement;
  const typingInAnotherField = el && (
    (el.tagName==='INPUT' || el.tagName==='TEXTAREA' || el.isContentEditable) &&
    el.id !== 'calcDisplay'
  );
  if(typingInAnotherField) return; // let user type into form fields normally

  const map={ '/':'√∑','*':'√ó','-':'‚àí','+':'+', 'Enter':'=', 'Backspace':'‚å´' };
  if(/[0-9\.\+\-\*\/]/.test(e.key) || e.key==='Enter' || e.key==='Backspace'){
    e.preventDefault(); press(map[e.key]??e.key);
  }
});

/* ============== Donut ============== */
function drawRing(id,{value,mort,other,bench}){
  const c=document.getElementById(id); if(!c) return;
  const ctx=c.getContext('2d');

  const scale=window.devicePixelRatio||1; const w=460,h=460;
  c.style.width='100%'; c.width=w*scale; c.height=h*scale;
  ctx.setTransform(scale,0,0,scale,0,0);

  const W=w,H=h,cx=W/2,cy=H/2;
  const R_OUT=190,R_IN=125,R=(R_OUT+R_IN)/2,LW=R_OUT-R_IN, START=-Math.PI/2;

  const styles=getComputedStyle(document.documentElement);
  const COL_MORT=styles.getPropertyValue('--mauve').trim()||'#B98EA7';
  const COL_LIENS=styles.getPropertyValue('--mint').trim()||'#83C08A';
  const COL_AVAIL=styles.getPropertyValue('--cream').trim()||'#F3F2ED';
  const COL_GOLD=styles.getPropertyValue('--gold').trim()||'#C6AA58';
  const COL_TRACK='#E7E1D6', COL_EDGE='#D9D3C9', COL_TEXT='#2F302B';

  ctx.clearRect(0,0,W,H);

  const V=Math.max(1,+value||1);
  const mortF=Math.max(0,Math.min(1,(+mort||0)/V));
  const lienF=Math.max(0,Math.min(1,(+other||0)/V));
  const benchF=Math.max(0.8,Math.min(1,(+bench||80)/100));

  ctx.lineCap='butt'; ctx.lineWidth=LW;
  function seg(a0,a1,col){ if(a1<=a0) return; ctx.beginPath(); ctx.arc(cx,cy,R,a0,a1); ctx.strokeStyle=col; ctx.stroke(); }

  // Track
  ctx.beginPath(); ctx.arc(cx,cy,R,0,Math.PI*2); ctx.strokeStyle=COL_TRACK; ctx.stroke();

  // Gold band 0 -> benchmark (available estimated equity within assumed LTV)
  const aGoldEnd = START + benchF*2*Math.PI;
  seg(START, aGoldEnd, COL_GOLD);

  // Cream benchmark -> 100% (untouchable equity per LTV rules)
  seg(aGoldEnd, START + 2*Math.PI, COL_AVAIL);

  // Debts overlay within gold
  const aDebt1 = START + Math.min(mortF, benchF)*2*Math.PI;
  seg(START, aDebt1, COL_MORT);
  const usedF = Math.min(benchF, mortF + lienF);
  seg(aDebt1, START + usedF*2*Math.PI, COL_LIENS);

  // Clean edges + "start"
  ctx.lineWidth=1.25; ctx.strokeStyle=COL_EDGE;
  ctx.beginPath(); ctx.arc(cx,cy,R_OUT-0.5,0,Math.PI*2); ctx.stroke();
  ctx.beginPath(); ctx.arc(cx,cy,R_IN+0.5,0,Math.PI*2); ctx.stroke();
  ctx.fillStyle=COL_TEXT; ctx.font='600 12px system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial';
  ctx.textAlign='center'; ctx.fillText('start', cx, cy-R_OUT-8);
}

/* ============== Equity logic ============== */
const v_value=document.getElementById('v_value');
const v_mort=document.getElementById('v_mort');
const v_other=document.getElementById('v_other');
const v_bench=document.getElementById('v_bench');

const v_debt=document.getElementById('v_debt');
const v_ltv=document.getElementById('v_ltv');
const v_max=document.getElementById('v_max');
const v_avail=document.getElementById('v_avail');

function computeValues(){
  const val=+v_value.value||0;
  const mort=+v_mort.value||0;
  const other=+v_other.value||0;
  const bench= +v_bench.value||80;
  const debt=mort+other;
  const ltv = val? (debt/val)*100 : 0;
  const maxAtBench = val*(bench/100);
  const availAtBench = Math.max(0, maxAtBench - debt);
  return {val,mort,other,bench,debt,ltv,maxAtBench,availAtBench};
}
function updateUI(){
  const x = computeValues();
  v_debt.textContent = `$${x.debt.toLocaleString()}`;
  v_ltv.textContent = `${x.ltv.toFixed(1)}%`;
  v_max.textContent = `$${x.maxAtBench.toLocaleString()}`;
  v_avail.textContent = `$${x.availAtBench.toLocaleString()}`;
  drawRing('v_donut',{value:x.val,mort:x.mort,other:x.other,bench:x.bench});
}
document.getElementById('recalcBtn').addEventListener('click',updateUI);
['v_value','v_mort','v_other'].forEach(id=>{
  document.getElementById(id).addEventListener('keydown',e=>{ if(e.key==='Enter'){ e.preventDefault(); updateUI(); } });
});

// Benchmark buttons
function setBench(b){
  v_bench.value=String(b);
  ['bench80','bench90','bench100'].forEach(id=>document.getElementById(id).classList.remove('active'));
  document.getElementById('bench'+b).classList.add('active');
  updateUI();
}
document.getElementById('bench80').onclick=()=>setBench(80);
document.getElementById('bench90').onclick=()=>setBench(90);
document.getElementById('bench100').onclick=()=>setBench(100);

// init
window.addEventListener('load', updateUI);

/* ============== Amortization ============== */
const loanAmt=document.getElementById('loanAmt');
const apr=document.getElementById('apr');
const term=document.getElementById('term');
const origDate=document.getElementById('origDate');
const curBal=document.getElementById('curBal');
const extra=document.getElementById('extra');
const biweekly=document.getElementById('biweekly');
const lump=document.getElementById('lump');
const lumpMonth=document.getElementById('lumpMonth');

const kpiBase=document.getElementById('kpiBase');
const kpiPayoff=document.getElementById('kpiPayoff');
const kpiSaved=document.getElementById('kpiSaved');
const kpiMonths=document.getElementById('kpiMonths');
const tbody=document.getElementById('amortBody');

(function seedDate(){
  const d=new Date(); d.setDate(1);
  origDate.value=d.toISOString().slice(0,10);
})();

document.getElementById('amortBtn').addEventListener('click', calcAmort);

function calcAmort(){
  const P0=+loanAmt.value||0;
  const r=(+apr.value||0)/100/12;
  const n=(+term.value||0)*12;
  if(!(P0>0 && n>0 && r>=0)) return;

  // Base monthly payment (original amount & full term)
  const basePay = r===0 ? P0/n : P0*r/(1-Math.pow(1+r,-n));

  // Working balance: current balance if provided, else original
  let bal = +curBal.value>0 ? +curBal.value : P0;

  // Start date
  const start = new Date(origDate.value || new Date());
  start.setDate(1);

  // Extras
  const extraMo = +extra.value||0;
  const lumpAmt = +lump.value||0;
  const lumpAt  = +lumpMonth.value||0;
  const biw     = (biweekly.value==='Yes'); // ‚âà one extra monthly payment/yr

  // Baseline (no extras) for payoff & interest
  const base = simulateAmort(P0, r, n, basePay, 0, false, 0, 0, start);
  // With extras (uses current balance if given)
  const withExtras = simulateAmort(bal, r, n, basePay, extraMo, biw, lumpAmt, lumpAt, start);

  // KPIs
  kpiBase.textContent = `$${basePay.toFixed(2)}`;
  kpiPayoff.textContent = withExtras.lastDate;
  const interestSaved = Math.max(0, base.totalInterest - withExtras.totalInterest);
  kpiSaved.textContent = `$${interestSaved.toLocaleString(undefined,{maximumFractionDigits:2})}`;
  const monthsSaved = Math.max(0, base.months - withExtras.months);
  kpiMonths.textContent = `${monthsSaved}`;

  // Table
  tbody.innerHTML='';
  withExtras.rows.forEach(rw=>{
    tbody.insertAdjacentHTML('beforeend',
      `<tr><td>${rw.i}</td><td>${rw.date}</td><td>${rw.pay}</td><td>${rw.int}</td><td>${rw.pr}</td><td>${rw.ex}</td><td>${rw.bal}</td></tr>`
    );
  });
}

// amortization engine
function simulateAmort(startBal, r, n, basePay, extraMo, biweekly, lumpAmt, lumpAt, startDate){
  let bal=startBal;
  let totalInt=0;
  const rows=[];
  let i=0;
  let d=new Date(startDate);

  while(bal>0 && i<n*2){ // guard
    i++;
    d = new Date(startDate.getFullYear(), startDate.getMonth()+i, 1);

    const interest = bal*r;
    let principal = basePay - interest;
    let extra = extraMo;

    // bi-weekly ‚âà one extra monthly payment every 12 months
    if(biweekly && i%12===0) extra += basePay;

    // one-time lump at month #
    if(lumpAmt>0 && i===lumpAt) extra += lumpAmt;

    // cap to remaining
    let total = principal + extra;
    if(total > bal + interest){
      principal = bal;
      extra = Math.max(0, bal + interest - principal);
      total = principal + extra;
      bal = 0;
    }else{
      bal -= (principal + extra);
    }

    totalInt += interest;

    rows.push({
      i,
      date: d.toLocaleString('en-US',{month:'short',year:'numeric'}),
      pay:  (basePay).toFixed(2),
      int:  (interest).toFixed(2),
      pr:   (principal).toFixed(2),
      ex:   (extra).toFixed(2),
      bal:  (Math.max(0,bal)).toFixed(2)
    });
  }

  return {
    rows,
    months:i,
    totalInterest: totalInt,
    lastDate: rows.length? rows[rows.length-1].date : '‚Äî'
  };
}

/* ============== Refi Break-Even ============== */
const refiCosts=document.getElementById('refiCosts');
const refiSavings=document.getElementById('refiSavings');
const refiMonths=document.getElementById('refiMonths');
const refiMonthsCeil=document.getElementById('refiMonthsCeil');
document.getElementById('refiBtn').addEventListener('click',()=>{
  const c=+refiCosts.value||0, s=+refiSavings.value||0;
  if(s<=0){ refiMonths.textContent='N/A'; refiMonthsCeil.textContent='N/A'; return; }
  const m=c/s;
  refiMonths.textContent = m.toFixed(2);
  refiMonthsCeil.textContent = Math.ceil(m).toString();
});
</script>
</body>
</html>
