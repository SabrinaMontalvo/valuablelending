<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Valuable Calculator‚Ñ¢ ‚Äî Old-School + Mortgage Tools</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="manifest" href="manifest.webmanifest" />
<style>
:root{
  --ink:#01311F; --gold:#C6AA58; --paper:#F3F2ED; --line:#E7E1D6; --muted:#58635e;
  --emerald:#0D2E24; --other:#55786c; --radius:16px;
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--paper);color:var(--ink);
  font:15.5px/1.55 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.wrap{max-width:1180px;margin:0 auto;padding:28px 20px}
header{background:var(--ink);color:#fff}
.hero{max-width:1180px;margin:0 auto;padding:22px 20px}
.hero h1{margin:6px 0 6px;font-weight:800;letter-spacing:.2px;
  font-size:clamp(26px,3.2vw,40px)}
.hero .lead{opacity:.92}
.badge{display:inline-block;background:#0a2f23;border:1px solid #1b4636;
  color:#fff;padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px}

.grid{display:grid;gap:20px}
.two-col{grid-template-columns:360px 1fr}
@media(max-width:960px){.two-col{grid-template-columns:1fr}}

.card{background:#fff;border:1px solid var(--line);border-radius:16px;
  box-shadow:0 10px 24px rgba(1,49,31,.08);padding:18px}
h2{margin:0 0 10px;font-size:clamp(18px,2.1vw,24px)}
label{display:block;font-size:12.5px;color:var(--muted);margin:8px 0 6px}
input,select,button{font:inherit}
input,select{width:100%;background:#fff;border:1px solid var(--line);
  border-radius:12px;padding:10px 12px;outline:none}
input:focus,select:focus{border-color:#c9b77c;box-shadow:0 0 0 3px rgba(198,170,88,.18)}
.kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.kpi{background:#f8f6f1;border:1px solid var(--line);border-radius:12px;padding:10px}
.kpi .label{font-size:12px;color:var(--muted)}
.kpi .value{font-weight:800}
.small{font-size:12.5px;color:var(--muted)}
.legend{display:flex;gap:16px;align-items:center;flex-wrap:wrap}
.sw{width:12px;height:12px;border-radius:3px;display:inline-block}

details summary{cursor:pointer;font-weight:700}
.calc-screen{background:#eff4f0;border:1px solid var(--line);border-radius:12px;
  padding:12px;text-align:right;font-weight:700}
.keys{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}
.key{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px;
  font-weight:700;cursor:pointer}
.key:hover{background:#faf8f0}
.key[data-k="="]{background:var(--gold)}
.key[data-k="C"],.key[data-k="‚å´"]{grid-column:span 2}

.canvas-wrap{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
canvas.chart{width:360px;height:360px;display:block}

.table-wrap{overflow:auto;border:1px solid var(--line);border-radius:12px}
table{width:100%;border-collapse:collapse}
thead th{background:#faf9f4;border-bottom:1px solid var(--line);padding:10px;text-align:left;font-size:14px}
tbody td{border-top:1px solid var(--line);padding:8px}
tbody tr:nth-child(odd){background:#fcfbf8}

footer{border-top:1px solid var(--line);background:#f6f5f1;margin-top:28px}
footer .wrap{padding:18px 20px}
footer a{color:var(--ink)}
</style>
</head>
<body>
  <header>
    <div class="hero">
      <span class="badge">NMLS #575897</span>
      <h1>Valuable Calculator‚Ñ¢ <span style="color:var(--gold)">Old-School</span> + Mortgage Tools</h1>
      <div class="lead small">
        Gain financial IQ. Free, nostalgic, and practical. Mortgage math that actually answers your questions ‚Äî equity,
        payoff time, and interest savings with extra payments. <b>Always consult a licensed professional.</b>
      </div>
    </div>
  </header>

  <main class="wrap">

    <!-- Two-column: calc (left) + equity donut (right) -->
    <section class="grid two-col">
      <!-- Collapsible Calculator -->
      <div class="card">
        <details open>
          <summary>üñ© Old-School Calculator</summary>
          <div style="margin-top:12px">
            <div id="screen" class="calc-screen">0</div>
            <div class="keys">
              <button class="key" data-k="7">7</button><button class="key" data-k="8">8</button><button class="key" data-k="9">9</button><button class="key" data-k="/">√∑</button>
              <button class="key" data-k="4">4</button><button class="key" data-k="5">5</button><button class="key" data-k="6">6</button><button class="key" data-k="*">√ó</button>
              <button class="key" data-k="1">1</button><button class="key" data-k="2">2</button><button class="key" data-k="3">3</button><button class="key" data-k="-">‚àí</button>
              <button class="key" data-k="0">0</button><button class="key" data-k=".">.</button><button class="key" data-k="=">=</button><button class="key" data-k="+">+</button>
              <button class="key" data-k="C">C</button><button class="key" data-k="‚å´">‚å´</button>
            </div>
            <p class="small">Tip: type numbers & operators on your keyboard, or tap the keys above.</p>
          </div>
        </details>
      </div>

      <!-- Equity / LTV / Donut -->
      <div class="card">
        <h2>üè† Equity / LTV (with other balances & 80% benchmark)</h2>
        <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:12px">
          <div>
            <label>Estimated Home Value ($)</label>
            <input id="v_value" type="number" value="330000" step="1000">
          </div>
          <div>
            <label>Primary Mortgage Balance ($)</label>
            <input id="v_mort" type="number" value="120000" step="1000">
          </div>
          <div>
            <label>Other Liens (HELOC / Solar / 2nd) ($)</label>
            <input id="v_other" type="number" value="10000" step="500">
          </div>
          <div>
            <label>Benchmark LTV (%)</label>
            <input id="v_bench" type="number" value="80" step="1">
          </div>
        </div>

        <div class="kpis" style="margin-top:10px">
          <div class="kpi"><div class="label">Total Debt (incl. other)</div><div class="value" id="v_debt">‚Äî</div></div>
          <div class="kpi"><div class="label">LTV</div><div class="value" id="v_ltv">‚Äî</div></div>
          <div class="kpi"><div class="label">Max @ Benchmark</div><div class="value" id="v_max">‚Äî</div></div>
          <div class="kpi"><div class="label">Available @ Benchmark</div><div class="value" id="v_avail">‚Äî</div></div>
        </div>

        <div class="canvas-wrap" style="margin-top:10px">
          <canvas id="v_donut" class="chart" width="360" height="360"></canvas>
          <div class="small" style="max-width:480px">
            <p><b>How to read the donut:</b></p>
            <ul>
              <li><b>Outer ring</b> = Equity (gold) vs Debt (emerald) for the home value.</li>
              <li>Thin tick mark = your <b>LTV benchmark</b> (e.g., 80%).</li>
              <li><b>Inner ring</b> splits Debt into <b>Mortgage</b> vs <b>Other Liens</b>.</li>
            </ul>
            <div class="legend">
              <span><span class="sw" style="background:var(--gold)"></span> Equity</span>
              <span><span class="sw" style="background:var(--ink)"></span> Debt total</span>
              <span><span class="sw" style="background:var(--emerald)"></span> Mortgage (inner)</span>
              <span><span class="sw" style="background:var(--other)"></span> Other liens (inner)</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Amortization (blank until Calculate) -->
    <section class="card" style="margin-top:18px">
      <h2>üìÖ Amortization with Start Date + Extra Payments</h2>
      <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:12px">
        <div>
          <label>Original Loan Amount ($)</label>
          <input id="a_amount" type="number" step="1000" placeholder="e.g., 300000">
        </div>
        <div>
          <label>APR (%)</label>
          <input id="a_rate" type="number" step="0.01" placeholder="e.g., 6.5">
        </div>
        <div>
          <label>Term (years)</label>
          <input id="a_years" type="number" step="1" placeholder="e.g., 30">
        </div>
        <div>
          <label>Origination Date</label>
          <input id="a_start" type="date">
        </div>
        <div>
          <label>Current Balance (optional)</label>
          <input id="a_current" type="number" placeholder="leave blank for new-loan">
        </div>

        <div>
          <label>Extra Principal ($/mo)</label>
          <input id="a_extra" type="number" value="0" step="50">
        </div>
        <div>
          <label>Bi-weekly plan</label>
          <select id="a_biweekly"><option value="0">No</option><option value="1">Yes (‚âà 13th payment/yr)</option></select>
        </div>
        <div>
          <label>One-time Lump ($)</label>
          <input id="a_lump" type="number" value="0" step="500">
        </div>
        <div>
          <label>Lump applied at month #</label>
          <input id="a_lump_month" type="number" value="12" step="1">
        </div>
      </div>

      <div class="kpis" style="margin-top:12px">
        <div class="kpi"><div class="label">Base P&I</div><div class="value" id="k_base_pi">‚Äî</div></div>
        <div class="kpi"><div class="label">Projected Payoff</div><div class="value" id="k_new_date">‚Äî</div></div>
        <div class="kpi"><div class="label">Interest Saved vs No Extras</div><div class="value" id="k_int_saved">‚Äî</div></div>
        <div class="kpi"><div class="label">Months Saved</div><div class="value" id="k_saved">‚Äî</div></div>
      </div>

      <div style="margin:10px 0;display:flex;gap:10px;justify-content:flex-end">
        <button id="a_calc" class="key" style="font-weight:800;background:var(--gold);border-color:#b29a4f">Calculate</button>
      </div>

      <div class="table-wrap">
        <table id="a_table">
          <thead>
            <tr>
              <th>#</th><th>Date</th>
              <th style="text-align:right">Payment</th>
              <th style="text-align:right">Interest</th>
              <th style="text-align:right">Principal</th>
              <th style="text-align:right">Extra</th>
              <th style="text-align:right">Balance</th>
            </tr>
          </thead>
          <tbody><!-- stays empty until Calculate --></tbody>
        </table>
      </div>

      <p class="small" style="margin-top:10px">
        Educational only; principal & interest shown (escrows not included). Not a commitment to lend.
        Bi-weekly modeled as one extra monthly payment per year (26 half-payments). Always consult a licensed professional.
      </p>
    </section>

  </main>

  <footer>
    <div class="wrap" style="padding-top:0">
      <div>¬© Sabrina Montalvo ‚Äî Valuable Calculator‚Ñ¢</div>
      <div class="small">Compliance: NMLS #575897 ¬∑
        <a href="terms.html">Terms</a> ¬∑ <a href="privacy.html">Privacy</a> ¬∑ <a href="accessibility.html">Accessibility</a>
      </div>
    </div>
  </footer>

<script>
/* ======= Calculator (with keyboard; never captures when typing in inputs) ======= */
(()=> {
  const screen = document.getElementById('screen'); if(!screen) return;
  let cur='0', op=null, mem=null;
  const render=()=>{screen.textContent=cur;}
  const press=(k)=>{
    if(/^[0-9]$/.test(k)) cur=(cur==='0')?k:cur+k;
    else if(k==='.' && !cur.includes('.')) cur+='.';
    else if(k==='C'){cur='0';op=null;mem=null;}
    else if(k==='‚å´') cur=(cur.length>1)?cur.slice(0,-1):'0';
    else if(['+','-','*','/'].includes(k)){mem=parseFloat(cur);op=k;cur='0';}
    else if(k==='=' && op && mem!=null){
      const a=mem,b=parseFloat(cur); let r=0;
      if(op==='+') r=a+b; if(op==='-') r=a-b; if(op==='*') r=a*b; if(op==='/') r=b===0?0:a/b;
      cur=String(r);op=null;mem=null;
    }
    render();
  };
  document.querySelectorAll('.key').forEach(b=>b.addEventListener('click',()=>press(b.dataset.k||b.textContent.trim())));
  document.addEventListener('keydown',(e)=>{
    const tag=(e.target.tagName||'').toLowerCase();
    if(tag==='input' || tag==='textarea' || tag==='select') return; // don't steal typing
    const map={Enter:'=',Backspace:'‚å´',Escape:'C','*':'*','/':'/','+':'+','-':'-','.' :'.'};
    if(/^[0-9]$/.test(e.key)) {press(e.key); return;}
    if(map[e.key]){press(map[e.key]); e.preventDefault();}
  });
  render();
})();

/* ======= Equity / LTV logic + 3-layer donut (outer equity vs debt, benchmark tick, inner mortgage vs other) ======= */
function money(v){return (v||0).toLocaleString(undefined,{style:'currency',currency:'USD'});}

function vUpdate(){
  const val   = +document.getElementById('v_value').value||0;
  const mort  = +document.getElementById('v_mort').value||0;
  const other = +document.getElementById('v_other').value||0;
  const bench = Math.max(0,Math.min(100,+document.getElementById('v_bench').value||0));

  const debt = mort+other;
  const ltv  = val? (debt/val)*100 : 0;

  document.getElementById('v_debt').textContent = money(debt);
  document.getElementById('v_ltv').textContent  = (Math.round(ltv*10)/10)+'%';
  const maxAtBench = val*(bench/100);
  const avail      = Math.max(0, maxAtBench - debt);
  document.getElementById('v_max').textContent   = money(maxAtBench);
  document.getElementById('v_avail').textContent = money(avail);

  drawDonutTriple('v_donut', {value:val,mort,other,bench});
}
['v_value','v_mort','v_other','v_bench'].forEach(id=>{
  const el=document.getElementById(id); if(el){el.addEventListener('input', vUpdate);}
});
window.addEventListener('load', vUpdate);

function drawDonutTriple(id, {value,mort,other,bench}){
  const c=document.getElementById(id); if(!c) return; const ctx=c.getContext('2d');
  const w=c.width, h=c.height; ctx.setTransform(1,0,0,1,0,0); ctx.clearRect(0,0,w,h);
  const cx=w/2, cy=h/2;

  const equity=Math.max(0, value-(mort+other));
  const debt  =Math.max(0, mort+other);
  const total =Math.max(value, debt, 1);

  // rings
  const R=155, r=105;            // outer ring
  const ring=(R+r)/2, lw=R-r;

  const r2=78, r3=48;            // inner ring (debt split)
  const inner=(r2+r3)/2, lw2=r2-r3;

  const start=-Math.PI/2;
  const styles=getComputedStyle(document.documentElement);
  const colEquity=styles.getPropertyValue('--gold').trim()||'#C6AA58';
  const colDebt  =styles.getPropertyValue('--ink').trim()||'#01311F';
  const colMort='#0D2E24', colOther='#55786c';

  // background guides
  ctx.lineCap='round';

  // OUTER: equity vs debt
  const eqFrac=Math.max(0, Math.min(1, equity/total));
  ctx.lineWidth=lw;
  ctx.beginPath(); ctx.arc(cx,cy,ring,start,start+Math.PI*2); ctx.strokeStyle='#ede8db'; ctx.stroke();

  ctx.beginPath(); ctx.arc(cx,cy,ring,start, start+Math.PI*2*eqFrac); ctx.strokeStyle=colEquity; ctx.stroke();
  ctx.beginPath(); ctx.arc(cx,cy,ring,start+Math.PI*2*eqFrac, start+Math.PI*2); ctx.strokeStyle=colDebt; ctx.stroke();

  // Benchmark tick (thin line on outer ring)
  const tickAngle = start + (bench/100)*Math.PI*2;
  ctx.save();
  ctx.translate(cx,cy); ctx.rotate(tickAngle);
  ctx.beginPath(); ctx.moveTo(0, -(ring+lw/2)+4); ctx.lineTo(0, -(ring-lw/2)-4);
  ctx.lineWidth=2.5; ctx.strokeStyle='#b49b59'; ctx.stroke();
  ctx.restore();

  // INNER: mortgage vs other (within debt)
  const mortFrac = debt? Math.max(0,Math.min(1,mort/debt)) : 0;
  ctx.lineWidth=lw2;
  ctx.beginPath(); ctx.arc(cx,cy,inner,start,start+Math.PI*2); ctx.strokeStyle='#ede8db'; ctx.stroke();
  ctx.beginPath(); ctx.arc(cx,cy,inner,start, start+Math.PI*2*mortFrac); ctx.strokeStyle=colMort; ctx.stroke();
  ctx.beginPath(); ctx.arc(cx,cy,inner,start+Math.PI*2*mortFrac, start+Math.PI*2); ctx.strokeStyle=colOther; ctx.stroke();

  // Center labels
  const ltvPct = Math.round((debt/total)*100);
  ctx.textAlign='center';
  ctx.fillStyle='#57625e'; ctx.font='600 12px system-ui'; ctx.fillText('LTV',cx,cy-18);
  ctx.fillStyle='#0e0e0e'; ctx.font='800 22px system-ui'; ctx.fillText(ltvPct+'%',cx,cy+4);
  ctx.fillStyle='#555'; ctx.font='600 12px system-ui'; ctx.fillText('Balances',cx,cy+24);
  ctx.fillStyle='#0e0e0e'; ctx.font='700 14px system-ui';
  ctx.fillText((mort+other).toLocaleString(undefined,{style:'currency',currency:'USD'}),cx,cy+42);
}

/* ======= Amortization (blank until Calculate) ======= */
const fmtUSD=(n)=> (n||0).toLocaleString(undefined,{style:'currency',currency:'USD'});
const addMonths=(d,m)=>{const t=new Date(d.getTime());t.setMonth(t.getMonth()+m);return t;}
const ymd=(d)=> d.toISOString().slice(0,10);
function mp(P,r,n){ if(r===0) return P/n; const a=Math.pow(1+r,n); return P*r*a/(a-1); }

function build({principal,apr,months,start,extra=0,biweekly=false,lump=0,lumpAt=null}){
  const r=apr/100/12, base=mp(principal,r,months), bonus=biweekly? base/12 : 0;
  let bal=principal, k=0, totalInt=0, rows=[];
  while(bal>0 && k<months+600){
    const d=addMonths(start,k), int=bal*r; let pr=base-int; let ex=extra+bonus;
    if(lump>0 && lumpAt && (k+1)===Number(lumpAt)) ex+=lump;
    if(pr+ex>bal) pr=Math.max(0,bal-ex);
    const pay=pr+int+ex; bal=Math.max(0, bal-pr-ex); totalInt+=int;
    rows.push({n:k+1,date:ymd(d),payment:pay,interest:int,principal:pr,extra:ex,balance:bal});
    if(bal<=0) break; k++;
  }
  return {rows,months:k+1,totalInt,basePI:base};
}

function gather(){
  const P = +document.getElementById('a_amount').value||0;
  const R = +document.getElementById('a_rate').value||0;
  const Y = +document.getElementById('a_years').value||0;
  const S = document.getElementById('a_start').value ? new Date(document.getElementById('a_start').value) : new Date();
  const cur= +document.getElementById('a_current').value||0;
  const extra= +document.getElementById('a_extra').value||0;
  const biw  = document.getElementById('a_biweekly').value==='1';
  const lump = +document.getElementById('a_lump').value||0;
  const lm   = +document.getElementById('a_lump_month').value||null;

  const totalMonths = Math.max(1,Math.round((Y||0)*12));
  let rem = totalMonths || 1;
  if(cur>0 && totalMonths>1){
    const elapsed = Math.max(0, Math.round((new Date()-S)/(1000*60*60*24*30.437)));
    rem = Math.max(1,totalMonths-elapsed);
  }
  const principal = cur>0? cur : P;
  return {principal, apr:R, months:rem, start:new Date(), extra, biweekly:biw, lump, lumpAt:lm};
}

function runAmort(){
  const cfg=gather();
  if(!cfg.principal || !cfg.apr || !cfg.months){ alert('Please enter amount, APR, and term.'); return; }
  const base=build({...cfg, extra:0, biweekly:false, lump:0, lumpAt:null});
  const now =build(cfg);

  document.getElementById('k_base_pi').textContent = fmtUSD(base.basePI);
  const newEnd=addMonths(new Date(), now.months-1);
  document.getElementById('k_new_date').textContent=newEnd.toLocaleDateString();
  document.getElementById('k_saved').textContent=Math.max(0,base.months-now.months);
  document.getElementById('k_int_saved').textContent=fmtUSD(Math.max(0, base.totalInt-now.totalInt));

  const tbody=document.querySelector('#a_table tbody'); tbody.innerHTML='';
  const show=now.rows; // full schedule
  const f2=(n)=>n.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2});
  for(const r of show){
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${r.n}</td>
      <td>${r.date}</td>
      <td style="text-align:right">${f2(r.payment)}</td>
      <td style="text-align:right">${f2(r.interest)}</td>
      <td style="text-align:right">${f2(r.principal)}</td>
      <td style="text-align:right;color:var(--gold)">${f2(r.extra)}</td>
      <td style="text-align:right">${f2(r.balance)}</td>`;
    tbody.appendChild(tr);
  }
}
document.getElementById('a_calc')?.addEventListener('click',runAmort);
</script>
</body>
</html>
